/*! This is 组件化开发web app  - 2016-07-15 */var H5 = function() {
    return this.id = ("h5_" + Math.random()).replace(".", "_"), this.el = $('<div class="h5" id="' + this.id + '">').hide(), 
    this.page = [], $("body").append(this.el), this.addPage = function(a, b) {
        var c = $('<div class="h5_page section">');
        return void 0 != a && c.addClass("h5_page_" + a), void 0 != b && c.text(b), this.el.append(c), 
        this.page.push(c), "function" == typeof this.whenAddPage && this.whenAddPage(), 
        this;
    }, this.addComponent = function(a, b) {
        var b = b || {};
        b = $.extend({
            type: "base"
        }, b);
        var c, d = this.page.slice(-1)[0];
        switch (b.type) {
          case "base":
            c = new H5ComponentBase(a, b);
            break;

          case "polyline":
            c = new H5ComponentPolyline(a, b);
            break;

          case "pie":
            c = new H5ComponentPie(a, b);
            break;

          case "bar":
            c = new H5ComponentBar(a, b);
            break;

          case "bar_v":
            c = new H5ComponentBar_v(a, b);
            break;

          case "radar":
            c = new H5ComponentRadar(a, b);
            break;

          case "ring":
            c = new H5ComponentRing(a, b);
            break;

          case "point":
            c = new H5ComponentPoint(a, b);
        }
        return d.append(c), this;
    }, this.loader = function(a) {
        this.el.fullpage({
            onLeave: function(a, b, c) {
                $(this).find(".h5_component").trigger("onLeave");
            },
            afterLoad: function(a, b) {
                $(this).find(".h5_component").trigger("onLoad");
            }
        }), this.page[0].find(".h5_component").trigger("onLoad"), this.el.show(), a && $.fn.fullpage.moveTo(a);
    }, this.loader = "function" == typeof H5_loading ? H5_loading : this.loader, this;
}, H5_loading = function(a, b) {
    var c = this.id;
    if (void 0 === this._images) {
        this._images = (a || []).length, this._loaded = 0, window[c] = this;
        for (s in a) {
            var d = a[s], e = new Image();
            e.onload = function() {
                window[c].loader();
            }, e.src = d;
        }
        return $("#rate").text("0%"), this;
    }
    return this._loaded++, $("#rate").text((this._loaded / this._images * 100 >> 0) + "%"), 
    this._loaded < this._images ? this : (window[c] = null, this.el.fullpage({
        onLeave: function(a, b, c) {
            $(this).find(".h5_component").trigger("onLeave");
        },
        afterLoad: function(a, b) {
            $(this).find(".h5_component").trigger("onLoad");
        }
    }), this.page[0].find(".h5_component").trigger("onload"), this.el.show(), void (b && $.fn.fullpage.moveTo(b)));
}, H5ComponentBar = function(a, b) {
    var c = new H5ComponentBase(a, b);
    return $.each(b.data, function(a, b) {
        var d = $('<div class="line">'), e = $('<div class="name">'), f = $('<div class="rate">'), g = $('<div class="per">'), h = 100 * b[1] + "%";
        if (b[2]) var i = 'style="background-color:' + b[2] + '"';
        f.html('<div class="bg" ' + i + "></div>"), f.css("width", h), e.text(b[0]), g.text(h), 
        d.append(e).append(f).append(g), c.append(d);
    }), c;
}, H5ComponentBar_v = function(a, b) {
    var c = new H5ComponentBar(a, b), d = 100 / b.data.length >> 0;
    return c.find(".line").width(d + "%"), $.each(c.find(".rate"), function() {
        var a = $(this).css("width");
        $(this).height(a).width("");
    }), $.each(c.find(".per"), function() {
        $(this).appendTo($(this).prev());
    }), c;
}, H5ComponentBase = function(a, b) {
    var b = b || {}, c = ("h5_c_" + Math.random()).replace(".", "_"), d = " h5_component_" + b.type, e = $('<div class="h5_component' + d + " h5_component_name_" + a + '" id="' + c + '">');
    return b.text && e.text(b.text), b.width && e.width(b.width / 2), b.height && e.height(b.height / 2), 
    b.css && e.css(b.css), b.bg && e.css("backgroundImage", "url(" + b.bg + ")"), b.center === !0 && e.css({
        marginLeft: b.width / 4 * -1 + "px",
        left: "50%"
    }), "function" == typeof b.onclick && e.on("click", b.onclick), e.on("onLoad", function() {
        return setTimeout(function() {
            e.addClass(d + "_load").removeClass(d + "_leave"), b.animateIn && e.animate(b.animateIn);
        }, b.delay || 0), !1;
    }), e.on("onLeave", function() {
        return setTimeout(function() {
            e.addClass(d + "_leave").removeClass(d + "_load"), b.animateOut && e.animate(b.animateOut);
        }, b.delay || 0), !1;
    }), e;
}, H5ComponentPie = function(a, b) {
    var c = new H5ComponentBase(a, b), d = b.width, e = b.height, f = document.createElement("canvas"), g = f.getContext("2d");
    f.width = g.width = d, f.height = g.height = e, $(f).css("zIndex", 1), c.append(f);
    var h = d / 2;
    g.beginPath(), g.fillStyle = "#eee", g.strokeStyle = "#eee", g.lineWidth = 1, g.arc(h, h, h, 0, 2 * Math.PI), 
    g.fill(), g.stroke();
    var f = document.createElement("canvas"), g = f.getContext("2d");
    f.width = g.width = d, f.height = g.height = e, $(f).css("zIndex", 2), c.append(f);
    for (var i = [ "red", "green", "blue", "#a00", "orange" ], j = 1.5 * Math.PI, k = 0, l = 2 * Math.PI, m = b.data.length, n = 0; n < m; n++) {
        var o = b.data[n], p = o[2] || (o[2] = i.pop());
        k = j + l * o[1], g.beginPath(), g.fillStyle = p, g.strokeStyle = p, g.lineWidth = .1, 
        g.moveTo(h, h), g.arc(h, h, h, j, k), g.fill(), g.stroke(), j = k;
        var q = $('<div class="text">');
        q.text(b.data[n][0]);
        var r = $('<div class="per">');
        r.text(100 * b.data[n][1] + "%"), q.append(r);
        var s = h + Math.sin(.5 * Math.PI - j) * h, t = h + Math.cos(.5 * Math.PI - j) * h;
        s > d / 2 ? q.css("left", s / 2) : q.css("right", (d - s) / 2), t > e / 2 ? q.css("top", t / 2) : q.css("bottom", (e - t) / 2), 
        b.data[n][2] && q.css("color", b.data[n][2]), q.css("opacity", 0), c.append(q);
    }
    var f = document.createElement("canvas"), g = f.getContext("2d");
    f.width = g.width = d, f.height = g.height = e, $(f).css("zIndex", 3), c.append(f), 
    g.fillStyle = "#eee", g.strokeStyle = "#eee", g.lineWidth = 1;
    var u = function(a) {
        g.clearRect(0, 0, d, e), g.beginPath(), g.moveTo(h, h), a <= 0 ? (g.arc(h, h, h, 0, 2 * Math.PI), 
        c.find(".text").css("opacity", 1)) : g.arc(h, h, h, j, j + 2 * Math.PI * a, !0), 
        g.fill(), g.stroke(), a >= 1 && (c.find(".text").css("transition", "all 0s"), H5ComponentPie.reSort(c.find(".text")), 
        c.find(".text").css("transition", "all 1s"), c.find(".text").css("opacity", 1), 
        g.clearRect(0, 0, d, e));
    };
    return u(0), c.on("onLoad", function() {
        for (var a = 0, b = 0; b < 100; b++) setTimeout(function() {
            a += .01, u(a);
        }, 10 * b + 500);
    }), c.on("onLeave", function() {
        for (var a = 1, b = 0; b < 100; b++) setTimeout(function() {
            a -= .01, u(a);
        }, 10 * b);
    }), c;
};

H5ComponentPie.reSort = function(a) {
    var b = function(a, b) {
        var c = $(a).offset(), d = $(b).offset(), e = [ c.left, $(a).width() + c.left ], f = [ c.top, $(a).height() + c.top ], g = [ d.left, $(a).width() + d.left ], h = [ d.top, $(a).height() + d.top ], i = e[0] > g[0] && e[0] < g[1] || e[1] > g[0] && e[1] < g[1], j = f[0] > h[0] && f[0] < h[1] || f[1] > h[0] && f[1] < h[1];
        return i && j;
    }, c = function(a, b) {
        "auto" != $(a).css("top") && $(a).css("top", parseInt($(a).css("top")) + $(b).height()), 
        "auto" != $(a).css("bottom") && $(a).css("bottom", parseInt($(a).css("bottom")) + $(b).height());
    }, d = [ a[0] ];
    $.each(a, function(a, c) {
        b(d[d.length - 1], c) && d.push(c);
    }), d.length > 1 && ($.each(d, function(a, b) {
        d[a + 1] && c(b, d[a + 1]);
    }), H5ComponentPie.reSort(d));
};

var H5ComponentPoint = function(a, b) {
    var c = new H5ComponentBase(a, b), d = b.data[0][1];
    return $.each(b.data, function(a, b) {
        var e = $('<div class="point point_' + a + '">'), f = $('<div class="name">' + b[0] + "</div>"), g = $('<div class="per">' + 100 * b[1] + "%</div>");
        f.append(g), e.append(f);
        var h = b[1] / d * 100 + "%";
        e.width(h).height(h), b[2] && e.css("background-color", b[2]), void 0 !== b[3] && void 0 !== b[4] && e.css("left", b[3]).css("top", b[4]), 
        c.append(e);
    }), c;
}, H5ComponentPolyline = function(a, b) {
    var c = new H5ComponentBase(a, b), d = b.width, e = b.height, f = document.createElement("canvas"), g = f.getContext("2d");
    f.width = g.width = d, f.height = g.height = e, c.append(f);
    var h = 10;
    g.beginPath(), g.lineWidth = 1, g.strokeStyle = "#aaaaaa", window.ctx = g;
    for (var i = 0; i < h + 1; i++) {
        var j = e / h * i;
        g.moveTo(0, j), g.lineTo(d, j);
    }
    h = b.data.length + 1;
    for (var k = d / h >> 0, i = 0; i < h + 1; i++) {
        var l = d / h * i;
        if (g.moveTo(l, 0), g.lineTo(l, e), b.data[i]) {
            var m = $('<div class="text">');
            m.text(b.data[i][0]), m.css("width", k / 2).css("left", l / 2 + k / 4), c.append(m);
        }
    }
    g.stroke();
    var f = document.createElement("canvas"), g = f.getContext("2d");
    f.width = g.width = d, f.height = g.height = e, c.append(f);
    var n = function(a) {
        g.clearRect(0, 0, d, e), g.beginPath(), g.lineWidth = 3, g.strokeStyle = "#ff8878";
        var c = 0, f = 0, h = d / (b.data.length + 1);
        for (i in b.data) {
            var j = b.data[i];
            c = h * i + h, f = e - j[1] * e * a, g.moveTo(c, f), g.arc(c, f, 5, 0, 2 * Math.PI);
        }
        g.moveTo(h, e - b.data[0][1] * e * a);
        for (i in b.data) {
            var j = b.data[i];
            c = h * i + h, f = e - j[1] * e * a, g.lineTo(c, f);
        }
        g.stroke(), g.strokeStyle = "rgba(255, 255, 255, 0)", g.lineWidth = 1, g.lineTo(c, e), 
        g.lineTo(h, e), g.fillStyle = "rgba(255, 136, 120, .2)", g.fill();
        for (i in b.data) {
            var j = b.data[i];
            c = h * i + h, f = e - j[1] * e * a, g.fillStyle = j[2] ? j[2] : "#595959", g.fillText((100 * j[1] >> 0) + "%", c - 10, f - 10);
        }
        g.stroke();
    };
    return c.on("onLoad", function() {
        for (var a = 0, b = 0; b < 100; b++) setTimeout(function() {
            a += .01, n(a);
        }, 10 * b + 500);
    }), c.on("onLeave", function() {
        for (var a = 1, b = 0; b < 100; b++) setTimeout(function() {
            a -= .01, n(a);
        }, 10 * b);
    }), c;
}, H5ComponentRadar = function(a, b) {
    var c = new H5ComponentBase(a, b), d = b.width, e = b.height, f = document.createElement("canvas"), g = f.getContext("2d");
    f.width = g.width = d, f.height = g.height = e, c.append(f);
    for (var h = d / 2, i = b.data.length, j = !1, k = 10; k > 0; k--) {
        g.beginPath();
        for (var l = 0; l < i; l++) {
            var m = 2 * Math.PI / 360 * (360 / i) * l, n = h + Math.sin(m) * h * (k / 10), o = h + Math.cos(m) * h * (k / 10);
            g.lineTo(n, o);
        }
        g.closePath(), g.fillStyle = (j = !j) ? "#99c0ff" : "#f1f9ff", g.fill();
    }
    for (var l = 0; l < i; l++) {
        var m = 2 * Math.PI / 360 * (360 / i) * l, n = h + Math.sin(m) * h, o = h + Math.cos(m) * h;
        g.moveTo(h, h), g.lineTo(n, o);
        var p = $('<div class="text">');
        p.text(b.data[l][0]), p.css("transition", "all .5s " + .1 * l + "s"), n > d / 2 ? p.css("left", n / 2 + 5) : p.css("right", (d - n) / 2 + 5), 
        o > e / 2 ? p.css("top", o / 2 + 5) : p.css("bottom", (e - o) / 2 + 5), b.data[l][2] && p.css("color", b.data[l][2]), 
        p.css("opacity", 0), c.append(p);
    }
    g.strokeStyle = "#e0e0e0", g.stroke();
    var f = document.createElement("canvas"), g = f.getContext("2d");
    f.width = g.width = d, f.height = g.height = e, c.append(f), g.strokeStyle = "#f00";
    var q = function(a) {
        a <= 1 && c.find(".text").css("opacity", 0), a >= 1 && c.find(".text").css("opacity", 1), 
        g.clearRect(0, 0, d, e);
        for (var f = 0; f < i; f++) {
            var j = 2 * Math.PI / 360 * (360 / i) * f, k = b.data[f][1] * a, l = h + Math.sin(j) * h * k, m = h + Math.cos(j) * h * k;
            g.lineTo(l, m);
        }
        g.closePath(), g.stroke(), g.fillStyle = "#ff7676";
        for (var f = 0; f < i; f++) {
            var j = 2 * Math.PI / 360 * (360 / i) * f, k = b.data[f][1] * a, l = h + Math.sin(j) * h * k, m = h + Math.cos(j) * h * k;
            g.beginPath(), g.arc(l, m, 5, 0, 2 * Math.PI), g.fill(), g.closePath();
        }
    };
    return c.on("onLoad", function() {
        for (var a = 0, b = 0; b < 100; b++) setTimeout(function() {
            a += .01, q(a);
        }, 10 * b + 500);
    }), c.on("onLeave", function() {
        for (var a = 1, b = 0; b < 100; b++) setTimeout(function() {
            a -= .01, q(a);
        }, 10 * b);
    }), c;
}, H5ComponentRing = function(a, b) {
    b.type = "pie", b.data.length > 1 && (b.data = [ b.data[0] ]);
    var c = new H5ComponentPie(a, b), d = $('<div class="mask">');
    c.addClass("h5_component_ring"), c.append(d);
    var e = c.find(".text");
    return e.attr("style", ""), b.data[0][2] && e.css("color", b.data[0][2]), d.append(e), 
    c;
};